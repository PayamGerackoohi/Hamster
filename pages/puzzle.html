<!DOCTYPE html><html><head><meta charset="utf-8"><title>Puzzle 2024-07-25</title><meta name="viewport" content="width=device-width,initial-scale=1"><link href="css/common.css" rel="stylesheet"><link href="css/puzzle.css" rel="stylesheet"><script src="js/nav.js" defer="defer"></script><script src="js/puzzle/data.js"></script></head><body><div id="nav" page="Puzzle"></div><div id="content"><div id="canvas-holder"><canvas id="canvas"></canvas></div><div class="controller"><button id="previous" onclick="onPreviousClicked()">&lt;</button><p id="steps"></p><button id="next" onclick="onNextClicked()">&gt;</button></div></div><script defer="defer">const canvasHolderEl=document.getElementById("canvas-holder"),canvasEl=document.getElementById("canvas"),canvas=canvasEl.getContext("2d"),previousEl=document.getElementById("previous"),nextEl=document.getElementById("next"),stepsEl=document.getElementById("steps");let step=0,dimension={},fontInfo={};const{blocks,key,operations,guides}=puzzleData;function observeWindowSize(){onSizeChanged(),window.onresize=onSizeChanged}function onSizeChanged(){updateCanvasSize({size:0}),updateDimension(canvasHolderEl.getBoundingClientRect()),updateFontInfo(),updateCanvasSize(dimension),draw()}function updateFontInfo(){var e=dimension.size/200;fontInfo={size:e,style:e+"em Arial"}}function updateDimension({width:e,height:n}){var t=Math.min(e,n)-2;dimension={width:e,height:n,size:t,blockSize:t/6}}function updateCanvasSize({size:e}){canvasEl.width=canvasEl.height=e}function onPreviousClicked(){--step<0?step=0:(previousOperation(),draw())}function onNextClicked(){(step+=1)>operations.length?step=operations.length:(nextOperation(),draw())}function previousOperation(){applyOperation(inverseOperation(operations[step])),updateSteps()}function nextOperation(){applyOperation(operations[step-1]),updateSteps()}function updateSteps(){stepsEl.textContent=step+"/"+operations.length}function applyOperation(e){var n=void 0===e.b?key:blocks[e.b];e.h&&(n.p[0]+=e.h),e.v&&(n.p[1]+=e.v)}function inverseOperation(e){return{...e,h:-e.h,v:-e.v}}function draw(){checkControllerState(),clearCanvas(),drawBlocks(),drawGuides(),drawKey()}function disableIf(e,n){n?e.setAttribute("disabled",""):e.removeAttribute("disabled")}function checkControllerState(){disableIf(previousEl,0===step),disableIf(nextEl,step===operations.length)}function clearCanvas(){canvas.clearRect(0,0,canvasEl.width,canvasEl.height)}function toCanvasCoord(e){var n=dimension["blockSize"];return[e.p[0]*n,e.p[1]*n,e.h*n,e.v*n]}function textCoord(e,n,t,a,o){var{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s}=canvas.measureText(e);return[n+a/2-e/2,t+o/2+(i-s)/2]}function drawKey(){canvas.beginPath();var[e,n,t,a]=toCanvasCoord(key);canvas.fillStyle="yellow",canvas.fillRect(e,n,t,a),canvas.rect(e,n,t,a),canvas.stroke()}function drawBlocks(){canvas.beginPath();let i=0;blocks.forEach(e=>{var[e,n,t,a]=toCanvasCoord(e),o=(canvas.fillStyle=t<a?"red":"green",canvas.fillRect(e,n,t,a),canvas.rect(e,n,t,a),i.toString()),[e,n]=(canvas.font=fontInfo.style,canvas.fillStyle="black",textCoord(o,e,n,t,a));canvas.fillText(o,e,n),i+=1}),canvas.stroke()}function drawGuides(){var e=guides[step];if(e){var n=e[0],t=e[1],a=e[2],o=e[3],e=e[4];if(canvas.beginPath(),0!==a){var i=1===e?">":"<";for(let e=0;e<a;e+=1)drawGuide(n+e,t,i)}if(0!==o){var s=1===e?"˅":"˄";for(let e=0;e<o;e+=1)drawGuide(n,t+e,s)}canvas.stroke()}}function drawGuide(e,n,t){var[e,n,a,o]=toCanvasCoord({p:[e,n],h:1,v:1}),[e,n]=(canvas.fillStyle="lightgray",canvas.fillRect(e,n,a,o),canvas.font=fontInfo.style,canvas.fillStyle="yellow",textCoord(t,e,n,a,o));canvas.fillText(t,e,n)}observeWindowSize(),updateSteps()</script></body></html>