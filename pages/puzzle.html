<!DOCTYPE html><html><head><meta charset="utf-8"><title>Puzzle</title><meta name="viewport" content="width=device-width,initial-scale=1"><link href="css/common.css" rel="stylesheet"><link href="css/puzzle.css" rel="stylesheet"><script src="js/nav.js" defer="defer"></script></head><body><div id="nav" page="Puzzle"></div><div id="content"><div id="canvas-holder"><canvas id="canvas" width="600" height="600"></canvas></div><div class="controller"><button id="previous" onclick="onPreviousClicked()">&lt;</button><p id="steps"></p><button id="next" onclick="onNextClicked()">&gt;</button></div></div><script>const canvasEl=document.getElementById("canvas"),canvas=canvasEl.getContext("2d"),previousEl=document.getElementById("previous"),nextEl=document.getElementById("next"),stepsEl=document.getElementById("steps");let blocks=[{p:[0,0],h:1,v:3},{p:[1,1],h:1,v:2},{p:[3,0],h:1,v:2},{p:[4,0],h:2,v:1},{p:[4,1],h:1,v:3},{p:[5,2],h:1,v:2},{p:[0,3],h:3,v:1},{p:[2,4],h:1,v:2},{p:[4,4],h:2,v:1},{p:[4,5],h:2,v:1}],key={p:[2,2],h:2,v:1};const operations=[{b:1,v:-1},{h:-1},{b:2,v:4},{b:3,h:-2},{b:4,v:-1},{b:5,v:-2},{b:6,h:3},{h:1},{b:0,v:3},{b:1,v:4},{b:3,h:-2},{h:-2},{b:7,v:-3},{b:6,h:-2},{b:4,v:1},{b:5,v:2},{b:3,h:4},{b:7,v:-1},{h:1},{b:0,v:-3},{b:6,h:-1},{b:2,v:-4},{b:8,h:-2},{b:9,h:-2},{b:4,v:2},{b:5,v:1},{h:3}],guides=[[1,0,0,1,-1],[1,2,1,0,-1],[3,2,0,4,1],[2,0,2,0,-1],[4,0,0,1,-1],[5,0,0,2,-1],[3,3,3,0,1],[3,2,1,0,1],[0,3,0,3,1],[1,2,0,4,1],[0,0,2,0,-1],[0,2,2,0,-1],[2,1,0,3,-1],[1,3,2,0,-1],[4,3,0,1,1],[5,2,0,2,1],[2,0,4,0,1],[2,0,0,1,-1],[2,2,1,0,1],[0,0,0,3,-1],[0,3,1,0,-1],[3,0,0,4,-1],[2,4,2,0,-1],[2,5,2,0,-1],[4,4,0,2,1],[5,4,0,1,1],[3,2,3,0,1]];let step=0;const blockSize=100;function onPreviousClicked(){--step<0?step=0:(previousOperation(),draw())}function onNextClicked(){(step+=1)>operations.length?step=operations.length:(nextOperation(),draw())}function previousOperation(){applyOperation(inverseOperation(operations[step])),updateSteps()}function nextOperation(){applyOperation(operations[step-1]),updateSteps()}function updateSteps(){stepsEl.textContent=step+"/"+operations.length}function applyOperation(e){var t=void 0===e.b?key:blocks[e.b];e.h&&(t.p[0]+=e.h),e.v&&(t.p[1]+=e.v)}function inverseOperation(e){return{...e,h:-e.h,v:-e.v}}function draw(){checkControllerState(),clearCanvas(),drawBlocks(),drawGuides(),drawKey()}function disableIf(e,t){t?e.setAttribute("disabled",""):e.removeAttribute("disabled")}function checkControllerState(){disableIf(previousEl,0===step),disableIf(nextEl,step===operations.length)}function clearCanvas(){canvas.clearRect(0,0,canvasEl.width,canvasEl.height)}function toCanvasCoord(e){return[e.p[0]*blockSize,e.p[1]*blockSize,e.h*blockSize,e.v*blockSize]}function textCoord(e,t,a,n,o){return[t+n/2-(1<e.length?25:10),a+o/2+15]}function drawKey(){canvas.beginPath();var[e,t,a,n]=toCanvasCoord(key);canvas.fillStyle="yellow",canvas.fillRect(e,t,a,n),canvas.rect(e,t,a,n),canvas.stroke()}function drawBlocks(){canvas.beginPath();let s=0;blocks.forEach(e=>{var[e,t,a,n]=toCanvasCoord(e),o=(canvas.fillStyle=a<n?"red":"green",canvas.fillRect(e,t,a,n),canvas.rect(e,t,a,n),s.toString()),[e,t]=textCoord(o,e,t,a,n);canvas.font="3em Arial",canvas.fillStyle="black",canvas.fillText(o,e,t),s+=1}),canvas.stroke()}function drawGuides(){var e=guides[step];if(e){var t=e[0],a=e[1],n=e[2],o=e[3],e=e[4];if(canvas.beginPath(),0!==n){var s=1===e?">":"<";for(let e=0;e<n;e+=1)drawGuide(t+e,a,s)}if(0!==o){var i=1===e?"˅":"˄";for(let e=0;e<o;e+=1)drawGuide(t,a+e,i)}canvas.stroke()}}function drawGuide(e,t,a){var[e,t,n,o]=toCanvasCoord({p:[e,t],h:1,v:1}),[e,t]=(canvas.fillStyle="lightgray",canvas.fillRect(e,t,n,o),textCoord(a,e,t,n,o));canvas.font="3em Arial",canvas.fillStyle="yellow",canvas.fillText(a,e,t)}updateSteps(),draw()</script></body></html>