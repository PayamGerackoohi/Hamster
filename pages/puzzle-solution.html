<!DOCTYPE html><html><head><meta charset="utf-8"><title>Puzzle 2024-07-28</title><meta name="viewport" content="width=device-width,initial-scale=1"><link href="css/common.css" rel="stylesheet"><link href="css/puzzle.css" rel="stylesheet"><script src="js/nav.js" defer="defer"></script><script src="js/puzzle/data.js"></script></head><body><div id="nav" page="Puzzle"></div><div id="content"><div id="canvas-holder"><canvas id="canvas"></canvas></div><div class="controller"><button id="previous" onclick="onPreviousClicked()">&lt;</button><p id="steps"></p><button id="next" onclick="onNextClicked()">&gt;</button></div></div><script defer="defer">const canvasHolderEl=document.getElementById("canvas-holder"),canvasEl=document.getElementById("canvas"),canvas=canvasEl.getContext("2d"),previousEl=document.getElementById("previous"),nextEl=document.getElementById("next"),stepsEl=document.getElementById("steps");let step=0,dimension={},fontInfo={};const{blocks,operations,guides}=puzzleData;function observeKeyPress(){document.addEventListener("keydown",e=>{switch(e.key){case"ArrowLeft":onPreviousClicked();break;case"ArrowRight":onNextClicked()}})}function observeWindowSize(){onSizeChanged(),window.onresize=onSizeChanged}function onSizeChanged(){updateCanvasSize({size:0}),updateDimension(canvasHolderEl.getBoundingClientRect()),updateFontInfo(),updateCanvasSize(dimension),draw()}function updateFontInfo(){var e=dimension.size/200;fontInfo={size:e,style:e+"em Arial"}}function updateDimension({width:e,height:n}){var t=Math.min(e,n)-2;dimension={width:e,height:n,size:t,blockSize:t/6}}function updateCanvasSize({size:e}){canvasEl.width=canvasEl.height=e}function onPreviousClicked(){--step<0?step=0:(previousOperation(),draw())}function onNextClicked(){(step+=1)>operations.length?step=operations.length:(nextOperation(),draw())}function previousOperation(){applyOperation(inverseOperation(operations[step])),updateSteps()}function nextOperation(){applyOperation(operations[step-1]),updateSteps()}function updateSteps(){stepsEl.textContent=step+"/"+operations.length}function applyOperation(e){var n=void 0===e.b?blocks[0]:blocks[e.b];e.h&&(n.x+=e.h),e.v&&(n.y+=e.v)}function inverseOperation(e){return{...e,h:-e.h,v:-e.v}}function draw(){checkControllerState(),clearCanvas(),drawBlocks(),drawGuides()}function disableIf(e,n){n?e.setAttribute("disabled",""):e.removeAttribute("disabled")}function checkControllerState(){disableIf(previousEl,0===step),disableIf(nextEl,step===operations.length)}function clearCanvas(){canvas.clearRect(0,0,canvasEl.width,canvasEl.height)}function toCanvasCoord(e){var n=dimension["blockSize"];return[e.x*n,e.y*n,(e.h||1)*n,(e.v||1)*n]}function textCoord(e,n,t,a,o){var{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s}=canvas.measureText(e);return[n+a/2-e/2,t+o/2+(i-s)/2]}function drawBlocks(){canvas.beginPath(),blocks.forEach((e,n)=>{var[e,t,a,o]=toCanvasCoord(e),a=a||1,o=o||1;canvas.fillStyle=0===n?"yellow":a<o?"red":"green",canvas.fillRect(e,t,a,o),canvas.rect(e,t,a,o),0!==n&&(n=n.toString(),[e,t]=(canvas.font=fontInfo.style,canvas.fillStyle="black",textCoord(n,e,t,a,o)),canvas.fillText(n,e,t))}),canvas.stroke()}function drawGuides(){var e=guides[step];if(e){var n=e[0],t=e[1],a=e[2],o=e[3],e=e[4];if(canvas.beginPath(),0!==a){var i=1===e?">":"<";for(let e=0;e<a;e+=1)drawGuide(n+e,t,i)}if(0!==o){var s=1===e?"˅":"˄";for(let e=0;e<o;e+=1)drawGuide(n,t+e,s)}canvas.stroke()}}function drawGuide(e,n,t){var[e,n,a,o]=toCanvasCoord({x:e,y:n,h:1,v:1}),[e,n]=(canvas.fillStyle="lightgray",canvas.fillRect(e,n,a,o),canvas.font=fontInfo.style,canvas.fillStyle="yellow",textCoord(t,e,n,a,o));canvas.fillText(t,e,n)}observeKeyPress(),observeWindowSize(),updateSteps()</script></body></html>