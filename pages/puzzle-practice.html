<!DOCTYPE html><html><head><meta charset="utf-8"><title>Puzzle 2024-08-01</title><meta name="viewport" content="width=device-width,initial-scale=1"><link href="css/common.css" rel="stylesheet"><link href="css/puzzle-practice.css" rel="stylesheet"><script src="js/nav.js" defer="defer"></script><script src="js/puzzle/data.js"></script></head><body><div id="nav" page="Puzzle -> Practice"></div><div id="content"><div id="timer"><p>⏱️</p><p id="time"></p></div><div id="container"><canvas id="canvas"></canvas><div id="block"></div><canvas id="overlay-canvas"></canvas></div></div><script>const containerEl=document.getElementById("container"),blockEl=document.getElementById("block"),canvasEl=document.getElementById("canvas"),overlayCanvasEl=document.getElementById("overlay-canvas"),timeEl=document.getElementById("time");let{time,blocks,target}=puzzleData,isPlaying=!0;const container={size:{width:0,height:0},grid:{u:6,v:6},gap:2,unit(){return{x:(this.size.width-this.gap)/this.grid.u-this.gap,y:(this.size.height-this.gap)/this.grid.v-this.gap}}};let unit=0;function start(){showTime(),tick()}function tick(){isPlaying?setTimeout(()=>{--time<0?alert("Timeup"):(showTime(),tick())},1e3):alert("Win")}function showTime(){timeEl.textContent="00:"+time.toString().padStart(2,"0")}function observeWindowSize(){onSizeChanged(),window.onresize=onSizeChanged}function onSizeChanged(){updateCanvasSize({size:0}),updateDimension(containerEl.getBoundingClientRect()),updateCanvasSize(container.size),draw()}function updateCanvasSize({size:t}){blockEl.style.width=blockEl.style.height=t+"px",canvasEl.width=canvasEl.height=t,overlayCanvasEl.width=overlayCanvasEl.height=t,unit=container.unit()}function updateDimension({width:t,height:n}){t=Math.min(t,n);container.size={width:t,height:t,size:t,blockSize:t/6}}function draw(){drawGrid(),drawBlocks(),drawTarget()}function drawTarget(){var t=container["gap"],n=overlayCanvasEl.getContext("2d"),e=(n.beginPath(),n.strokeStyle="purple",n.lineWidth=5,target.x*(unit.x+t)+t),i=target.y*(unit.y+t)+t,t=2*unit.x+t,a=unit.y;n.strokeRect(e,i,t,a),n.stroke()}function drawGrid(){var e=canvasEl.getContext("2d"),i=(e.beginPath(),container.size.width),a=container.size.height,o=(e.lineWidth=container.gap,e.strokeStyle="#3F3F3F",container.gap/2);for(let t=0,n=0;t<=container.grid.u;t++,n+=unit.x+container.gap)e.moveTo(o+n,0),e.lineTo(o+n,a);for(let t=0,n=0;t<=container.grid.v;t++,n+=unit.y+container.gap)e.moveTo(0,o+n),e.lineTo(i,o+n);e.stroke()}function drawBlocks(){blockEl.innerHTML="",blocks.forEach(({x:t,y:n,h:e,v:i},a)=>{var o=blockEl.appendChild(document.createElement("div")),r=(o.classList.add("box",e?"horizontal":"vertical"),0===a&&o.classList.add("key"),container)["gap"];o.style.left=t*(unit.x+r)+r-1+"px",o.style.top=n*(unit.y+r)+r-1+"px",o.style.width=(e||1)*(unit.x+r)-r+"px",o.style.height=(i||1)*(unit.y+r)-r+"px",observeMovement(a,o)})}function observeMovement(r,i){var{left:t,top:n}=getComputedStyle(i);const s=i.classList.contains("horizontal");let e=0,a=s?+t.replace("px",""):+n.replace("px",""),c={min:0,max:0};function o(t){var n=s?t.clientX-e.x:t.clientY-e.y;e=u(t),a=Math.max(c.minPx,Math.min(a+n,c.maxPx)),d()}function l(t){window.removeEventListener("pointermove",o),window.removeEventListener("pointerup",l),i.style.transition=".1s";var{index:n,px:e}=function(t){var n=s?unit.x:unit.y,e=container["gap"],t=Math.round((t-e)/(n+e)),n=t*(n+e)+e-2;return{index:t,px:n}}(a),e=(a=e,d(),n);s?blocks[r].x=e:blocks[r].y=e,(n=blocks[0])&&n.x===target.x&&n.y===target.y&&(isPlaying=!1)}function d(){var t=a+1+"px";s?i.style.left=t:i.style.top=t}function u({clientX:t,clientY:n}){return{x:t,y:n}}i.addEventListener("touchstart",t=>t.preventDefault()),i.addEventListener("pointerdown",function(t){i.style.transition="unset",e=u(t),function(){const{x:e,y:i,h:a,v:o}=blocks[r],t=container["gap"];s?(c={min:0,max:container.grid.u-a},blocks.forEach((t,n)=>{n!==r&&t.y<=i&&t.y+(t.v||1)>i&&(t.x<e?c.min=Math.max(c.min,t.x+(t.h||1)):c.max=Math.min(c.max,t.x-a))}),c.minPx=c.min*(unit.x+t)+t-2,c.maxPx=c.max*(unit.x+t)+t-2):(c={min:0,max:container.grid.v-o},blocks.forEach((t,n)=>{n!==r&&t.x<=e&&t.x+(t.h||1)>e&&(t.y<i?c.min=Math.max(c.min,t.y+(t.v||1)):c.max=Math.min(c.max,t.y-o))}),c.minPx=c.min*(unit.y+t)+t-2,c.maxPx=c.max*(unit.y+t)+t-2)}(),window.addEventListener("pointermove",o),window.addEventListener("pointerup",l)})}observeWindowSize(),start()</script></body></html>