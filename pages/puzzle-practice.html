<!DOCTYPE html><html><head><meta charset="utf-8"><title>Puzzle 2024-08-05</title><meta name="viewport" content="width=device-width,initial-scale=1"><link href="css/common.css" rel="stylesheet"><link href="css/puzzle-practice.css" rel="stylesheet"><script src="js/nav.js" defer="defer"></script><script src="js/puzzle/data.js"></script></head><body><div id="nav" page="Puzzle -> Practice"></div><div id="content"><div id="status-bar"><div id="timer"><p>⏱️</p><p id="time"></p></div><button id="refresh-button" class="ripple" onclick="refresh()">↺</button></div><div id="container"><canvas id="canvas"></canvas><div id="block"></div><canvas id="overlay-canvas"></canvas></div></div><script>const containerEl=document.getElementById("container"),blockEl=document.getElementById("block"),canvasEl=document.getElementById("canvas"),overlayCanvasEl=document.getElementById("overlay-canvas"),timeEl=document.getElementById("time"),refreshButtonEl=document.getElementById("refresh-button"),{time,blocks,target}=puzzleData;let isPlaying=!0;const container={size:{width:0,height:0},grid:{u:6,v:6},gap:2,unit(){return{x:(this.size.width-this.gap)/this.grid.u-this.gap,y:(this.size.height-this.gap)/this.grid.v-this.gap}}};let unit=0,threadId=0,timeoutId;function main(){this.time,this.blocks=JSON.parse(JSON.stringify(blocks)),resetTime(),observeWindowSize(),start()}function resetTime(){this.time=time,showTime()}function start(){setTimeout(showRefreshButton,1e3),tick(threadId)}function showRefreshButton(){refreshButtonEl.removeAttribute("hide")}function hideRefreshButton(){refreshButtonEl.setAttribute("hide","")}function refresh(){hideRefreshButton(),stopTicking(),resetState(),this.blocks=JSON.parse(JSON.stringify(blocks)),draw(),start()}function stopTicking(){threadId+=1,clearTimeout(timeoutId)}function resetState(){isPlaying=!0,resetTime()}function tick(t){t===threadId&&(isPlaying?timeoutId=setTimeout(()=>{t===threadId&&(--this.time,this.time<0?alert("Timeup"):(showTime(),tick(t)))},1e3):alert("Win"))}function showTime(){let t="01:00";t=60===this.time?"01:00":"00:"+this.time.toString().padStart(2,"0"),timeEl.textContent=t}function observeWindowSize(){onSizeChanged(),window.onresize=onSizeChanged}function onSizeChanged(){updateCanvasSize({size:0}),updateDimension(containerEl.getBoundingClientRect()),updateCanvasSize(container.size),draw()}function updateCanvasSize({size:t}){blockEl.style.width=blockEl.style.height=t+"px",canvasEl.width=canvasEl.height=t,overlayCanvasEl.width=overlayCanvasEl.height=t,unit=container.unit()}function updateDimension({width:t,height:e}){t=Math.min(t,e);container.size={width:t,height:t,size:t,blockSize:t/6}}function draw(){drawGrid(),drawBlocks(),drawTarget()}function drawTarget(){var t=container["gap"],e=overlayCanvasEl.getContext("2d"),i=(e.clearRect(0,0,overlayCanvasEl.width,overlayCanvasEl.height),e.beginPath(),e.strokeStyle="purple",e.lineWidth=5,target.x*(unit.x+t)+t),n=target.y*(unit.y+t)+t,t=2*unit.x+t,a=unit.y;e.strokeRect(i,n,t,a),e.stroke()}function drawGrid(){var i=canvasEl.getContext("2d"),n=(i.clearRect(0,0,canvasEl.width,canvasEl.height),i.beginPath(),container.size.width),a=container.size.height,o=(i.lineWidth=container.gap,i.strokeStyle="#3F3F3F",container.gap/2);for(let t=0,e=0;t<=container.grid.u;t++,e+=unit.x+container.gap)i.moveTo(o+e,0),i.lineTo(o+e,a);for(let t=0,e=0;t<=container.grid.v;t++,e+=unit.y+container.gap)i.moveTo(0,o+e),i.lineTo(n,o+e);i.stroke()}function drawBlocks(){blockEl.innerHTML="",this.blocks.forEach(({x:t,y:e,h:i,v:n},a)=>{var o=blockEl.appendChild(document.createElement("div")),r=(o.classList.add("box",i?"horizontal":"vertical"),0===a&&o.classList.add("key"),container)["gap"];o.style.left=t*(unit.x+r)+r-1+"px",o.style.top=e*(unit.y+r)+r-1+"px",o.style.width=(i||1)*(unit.x+r)-r+"px",o.style.height=(n||1)*(unit.y+r)-r+"px",observeMovement(a,o)})}function observeMovement(r,n){var{left:t,top:e}=getComputedStyle(n);const s=n.classList.contains("horizontal");let i=0,a=s?+t.replace("px",""):+e.replace("px",""),c={min:0,max:0};function o(t){var e=s?t.clientX-i.x:t.clientY-i.y;i=d(t),a=Math.max(c.minPx,Math.min(a+e,c.maxPx)),h()}function l(t){window.removeEventListener("pointermove",o),window.removeEventListener("pointerup",l),n.style.transition=".1s";var{index:e,px:i}=function(t){var e=s?unit.x:unit.y,i=container["gap"],t=Math.round((t-i)/(e+i)),e=t*(e+i)+i-2;return{index:t,px:e}}(a);a=i,h(),function(t){s?this.blocks[r].x=t:this.blocks[r].y=t}(e),function(){var t=this.blocks[0];t&&t.x===target.x&&t.y===target.y&&(isPlaying=!1)}()}function h(){var t=a+1+"px";s?n.style.left=t:n.style.top=t}function d({clientX:t,clientY:e}){return{x:t,y:e}}n.addEventListener("touchstart",t=>t.preventDefault()),n.addEventListener("pointerdown",function(t){n.style.transition="unset",i=d(t),function(){const{x:i,y:n,h:a,v:o}=this.blocks[r],t=container["gap"];s?(c={min:0,max:container.grid.u-a},this.blocks.forEach((t,e)=>{e!==r&&t.y<=n&&t.y+(t.v||1)>n&&(t.x<i?c.min=Math.max(c.min,t.x+(t.h||1)):c.max=Math.min(c.max,t.x-a))}),c.minPx=c.min*(unit.x+t)+t-2,c.maxPx=c.max*(unit.x+t)+t-2):(c={min:0,max:container.grid.v-o},this.blocks.forEach((t,e)=>{e!==r&&t.x<=i&&t.x+(t.h||1)>i&&(t.y<n?c.min=Math.max(c.min,t.y+(t.v||1)):c.max=Math.min(c.max,t.y-o))}),c.minPx=c.min*(unit.y+t)+t-2,c.maxPx=c.max*(unit.y+t)+t-2)}(),window.addEventListener("pointermove",o),window.addEventListener("pointerup",l)})}main()</script></body></html>